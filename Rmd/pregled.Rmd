---
title: "pregled"
author: "1349136962 FILIP MIŠKOVIĆ"
date: "2024-01-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```


```{r}
hotel <- read_csv("../data/Hotel bookings/hotel_bookings.csv")
hotel

# Ako nemate numerički ekvivalent za sve mjesece, možete koristiti ovu mapu
month_mapping <- c("January" = 1, "February" = 2, "March" = 3, "April" = 4, "May" = 5, "June" = 6, "July" = 7, "August" = 8, "September" = 9, "October" = 10, "November" = 11, "December" = 12)

# Koristite funkciju match da biste dobili numeričke ekvivalente
hotel$arrival_date_month <- match(hotel$arrival_date_month, names(month_mapping))

hotel$arrival_date <- as.Date(paste(hotel$arrival_date_year, hotel$arrival_date_month, hotel$arrival_date_day_of_month, sep = "-"))

hotel$arrival_date_year <- NULL
hotel$arrival_date_month <- NULL
hotel$arrival_date_day_of_month <- NULL

hotel$reservation_status_date <- as.Date(hotel$reservation_status_date, format = "%d-%m-%y")

glimpse(hotel)

sum(hotel$is_repeated_guest)
unique(hotel$is_repeated_guest)
table(hotel$days_in_waiting_list)

#proba

hotel

```
```{r}
#Altea
#Dolaze li više ljudi s djecom ili bez djece?
glimpse(hotel)

bezDjece <- hotel[(hotel$adults > 0) & (hotel$children==0), ]
sDjecom <- hotel[(hotel$adults > 0) & (hotel$children>0), ]

ggplot() +
  geom_bar(data = sDjecom, aes(x = "S djecom", fill = "S djecom")) +
  geom_bar(data = bezDjece, aes(x = "Bez djece", fill ="Bez djece")) +
  labs(title = "Analiza gostiju - dolasci s djecom naspram bez djece") +
  scale_fill_brewer(palette = "Dark2", name="Legenda") 
  


#Tip sobe za goste s djecom ili bez?


#Koji gosti dolaze više autima (s djecom ili bez)?


#Analiziranje prosječnog vremena boravka gostiju.


```

```{r}
# Filipove škrabotine

# Koliko ranije gost rezervira smještaj?
hotel
lead_time <- data.frame(NumOfDays = as.numeric(names(table(hotel$lead_time))), Frequency = as.numeric(table(hotel$lead_time)))
lead_time
ggplot(lead_time, aes(x = NumOfDays, y = Frequency)) + 
  geom_freqpoly(stat = "identity") +
  labs(title = "Vrijeme rezerviranja prije dolaska", x = "Broj dana", y = "Broj gostiju")


# Koliko često gosti otkazuju rezervaciju?
hotel[hotel$is_canceled == 1, ]
checkOut <- hotel[hotel$reservation_status == "Check-Out", c("reservation_status", "reservation_status_date", "arrival_date")]
checkOut

ggplot(hotel, aes(x = "", fill = reservation_status)) +
  geom_bar(color = "white", position = "fill") +
  labs(x = "Statusi rezervacija", y = "Omjer", fill = "Status") +
  theme(aspect.ratio = 2/1)

# Identifikacija najpopularnijih tipova soba ili paketa.
# ima 10 tipova soba!
table(hotel$reserved_room_type)

ggplot(hotel, aes(x = "", fill = reserved_room_type)) +
  geom_bar(color = "white", position = "fill") +
  labs(x = "Tip sobe")


# Odnos ispunjenih i neispinjenih zahtjeva gostiju
ispunjeniZahtjevi <- hotel[hotel$reserved_room_type == hotel$assigned_room_type, c("reserved_room_type", "assigned_room_type")]
neispunjeniZahtjevi <- hotel[hotel$reserved_room_type != hotel$assigned_room_type, c("reserved_room_type", "assigned_room_type")]

ggplot() +
  geom_bar(data = ispunjeniZahtjevi, aes(x = "Ispunjeni zahtjevi", fill = "Ispunjeni zahtjevi")) +
  geom_bar(data = neispunjeniZahtjevi, aes(x = "Neispunjeni zahtjevi", fill = "Neispunjeni zahtjevi")) +
  labs(title = "Odnos ispunjenih i neispunjenih zahtjeva gostiju", x = "Zahtjevi gostiju", y = "Broj zahtjeva", fill = "Legenda")

```



#IVA
```{r}
hotel <- read_csv("../data/Hotel bookings/hotel_bookings.csv")
hotel
head(hotel, 15)

#Posjećenost kroz godine. Koja godina je najviša posjećenost? 

#datumi po godini 
table(hotel$arrival_date_year) 

#ne uzimamo u obzir one koji su otkazali
hotel_filtriran <- hotel %>% filter(is_canceled == 0)

#datumi po godini - hotel filtriran
table(hotel_filtriran$arrival_date_year)

#koristiti arrival_date_year (SORRY FILIP, IPAK TREBA!)
godisnja_statistika <- hotel_filtriran %>% group_by(arrival_date_year) %>% summarise(visits = n()) 


ggplot(godisnja_statistika, aes(x = as.factor(arrival_date_year), y = visits, fill = as.factor(arrival_date_year))) +
  geom_bar(stat = "identity") +
  scale_fill_brewer(palette = "Accent") +
  labs(title = "Godišnja posjećenost",
       x = "Godina",
       y = "Broj posjeta") +
  theme_minimal() +
  guides(fill = guide_legend(title = "Godine"))



#Koje godine je bilo najvise otkazanih rezervacija?
otkazane_rezevracije <- table(hotel$arrival_date_year) - table(hotel_filtriran$arrival_date_year)
otkazane_rezervacije_df <- data.frame(godina = names(otkazane_rezevracije), otkazane_rezevracije = as.numeric(otkazane_rezevracije))
otkazane_rezervacije_df

ggplot(otkazane_rezervacije_df, aes(x = godina, y = otkazane_rezevracije, fill = godina)) +
  geom_bar(stat = "identity") +
  scale_fill_brewer(palette = "Paired") +
  labs(title = "Broj otkazanih rezervacija na godišnjoj razini",
       x = "",
       y = "Broj otkazanih rezervacija") +
  theme_minimal() + 
  guides(fill = guide_legend(title = "Godine"))

#Istraživanje sezonskih varijacija u rezervacijama tijekom godine. (Kroz jednu najpopularniju i najnepopularniju godinu statistika po mjesecima.)

#Izdvajanje godine i mjeseca
hotel_filtriran
hotel_godisnje_doba <- hotel_filtriran %>%  
  mutate(godisnje_doba = case_when(arrival_date_month %in% 3:5 ~ "Proljeće",
                                   arrival_date_month %in% 6:8 ~ "Ljeto",
                                   arrival_date_month %in% 9:11 ~ "Jesen",
                                   TRUE ~ "Zima"))

# Filtriranje podataka za najpopularniju i najmanje popularnu godinu
najpopularnija_godina <- hotel_godisnje_doba %>%
  group_by(arrival_date_year) %>%
  summarise(broj_rezervacija = n()) %>%
  filter(broj_rezervacija == max(broj_rezervacija)) %>%
  pull(arrival_date_year)

najnepopularnija_godina <- hotel_godisnje_doba %>%
  group_by(arrival_date_year) %>%
  summarise(broj_rezervacija = n()) %>%
  filter(broj_rezervacija == min(broj_rezervacija)) %>%
  pull(arrival_date_year)

# Filtrirajte podatke za najpopularniju godinu
najpopularnija_godisnja_statistika <- hotel_godisnje_doba %>%
  filter(arrival_date_year == najpopularnija_godina)

# Filtrirajte podatke za najnepopularniju godinu
najnepopularnija_godisnja_statistika <- hotel_godisnje_doba %>%
  filter(arrival_date_year == najnepopularnija_godina)


# ggplot  za najpopularniju godinu
ggplot(najpopularnija_godisnja_statistika, aes(x = arrival_date_month, fill = godisnje_doba)) +
  geom_bar(position = "stack") +
  labs(title = paste("Sezonske varijacije u najpopularnijoj godini:", najpopularnija_godina),
       x = "Mjesec",
       y = "Broj rezervacija") +
  scale_fill_brewer(palette = "Set3") +
  theme_minimal() + 
  guides(fill = guide_legend(title = "Godišnje doba"))

# ggplot  za najpopularniju godinu
ggplot(najnepopularnija_godisnja_statistika, aes(x = arrival_date_month, fill = godisnje_doba)) +
  geom_bar(position = "stack") +
  labs(title = paste("Sezonske varijacije u najnepopularnijoj godini:", najnepopularnija_godina),
       x = "Mjesec",
       y = "Broj rezervacija") +
  scale_fill_brewer(palette = "Set3") +
  theme_minimal() + 
   guides(fill = guide_legend(title = "Godišnje doba"))


#Iz koje države dolazi najviše gostiju po godine? --FIX THIS, NOW WORKING
# top 10 država prema broju posjetitelja
top_countries <- hotel_filtriran
  group_by(country) %>%
  summarise(visit_count = n()) %>%
  top_n(10, wt = visit_count)

ggplot(top_countries, aes(x = fct_reorder(country, visit_count), y = visit_count, fill = country)) +
  geom_bar(stat = "identity") +
  labs(title = "Top 10 Visitor Countries",
       x = "Country",
       y = "Number of Visitors") +
  scale_fill_brewer(palette = "Set3") +
  theme_minimal()






```


